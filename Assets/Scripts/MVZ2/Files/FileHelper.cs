#nullable enable // autogenerated

using System;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using SFB;
#if UNITY_STANDALONE_OSX || UNITY_STANDALONE_WIN || UNITY_STANDALONE_LINUX || UNITY_EDITOR
#elif UNITY_IOS || UNITY_ANDROID
using UnityEngine;
#endif


namespace MVZ2.IO
{
    public static class FileHelper
    {
        public static void ValidateDirectory(string filePath)
        {
            var dir = Path.GetDirectoryName(filePath);
            if (!Directory.Exists(dir))
            {
                Directory.CreateDirectory(dir);
            }
        }
        public static void WriteBytes(Stream stream, byte[] bytes)
        {
            stream.Write(bytes, 0, bytes.Length);
        }
        public static Task<string?> OpenExternalFile(string[] extensions, Action<string> importAction)
        {
#if UNITY_STANDALONE_OSX || UNITY_STANDALONE_WIN || UNITY_STANDALONE_LINUX || UNITY_EDITOR
            var selectedPathes = StandaloneFileBrowser.OpenFilePanel("", "", extensions.Select(e => new ExtensionFilter(string.Empty, extensions)).ToArray(), false);
            if (selectedPathes.Length == 0)
                return Task.FromResult<string?>(null);
            var importPath = selectedPathes[0];
            importAction?.Invoke(importPath);
            return Task.FromResult<string?>(importPath);
#else
            return Task.FromResult<string?>(null);
#endif
        }
        public static async Task<string?> SaveExternalFile(string defaultName, string[] extensions, Action<string> saveAction)
        {
#if UNITY_STANDALONE_OSX || UNITY_STANDALONE_WIN || UNITY_STANDALONE_LINUX || UNITY_EDITOR
            var exportPath = StandaloneFileBrowser.SaveFilePanel("", "", defaultName, extensions.Select(e => new ExtensionFilter(string.Empty, e)).ToArray());
            if (string.IsNullOrEmpty(exportPath))
                return null;
            saveAction?.Invoke(exportPath);
            await Task.CompletedTask;
            return exportPath;
#else
            await Task.CompletedTask;
            return null;
#endif
        }
    }
}
