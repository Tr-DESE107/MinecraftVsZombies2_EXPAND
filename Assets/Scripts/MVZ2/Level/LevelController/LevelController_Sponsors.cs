#nullable enable // autogenerated

using MVZ2.GameContent.Contraptions;
using MVZ2.GameContent.Effects;
using MVZ2.Supporters;
using MVZ2.Vanilla.Callbacks;
using PVZEngine.Callbacks;
using PVZEngine.Entities;
using PVZEngine.Level;
using Tools;

namespace MVZ2.Level
{
    public partial class LevelController
    {
        private void AddLevelCallbacks_Sponsors(LevelEngine level)
        {
            level.AddTrigger(VanillaLevelCallbacks.POST_USE_ENTITY_BLUEPRINT, EnginePostUseEntityBlueprintCallback);
        }
        private void EnginePostUseEntityBlueprintCallback(VanillaLevelCallbacks.PostUseEntityBlueprintParams param, CallbackResult callbackResult)
        {
            var output = param.placeOutput;
            var entity = output.entity;
            if (entity == null)
                return;
            var seed = param.blueprint;
            var definition = param.definition;
            var heldData = param.heldData;
            if (!Main.OptionsManager.ShowSponsorNames())
                return;
            if (entity.IsEntityOf(VanillaContraptionID.furnace))
            {
                ShowFurnaceSponsorName(entity);
            }
            else if (entity.IsEntityOf(VanillaContraptionID.moonlightSensor))
            {
                ShowMoonlightSensorSponsorName(entity);
            }
            else if (entity.IsEntityOf(VanillaContraptionID.gunpowderBarrel))
            {
                ShowGunpowderBarrelSensorSponsorName(entity);
            }
        }
        private void ShowFurnaceSponsorName(Entity furnace)
        {
            var names = Main.SponsorManager.GetSponsorPlanNames(SponsorPlans.Furnace.TYPE, SponsorPlans.Furnace.FURNACE);
            if (names.Length <= 0)
                return;
            furnace.Spawn(VanillaEffectID.floatingText, furnace.GetCenter(), rng.Next())?.Let(e =>
            {
                var name = names.Random(e.RNG);
                FloatingText.SetText(e, name);
            });
        }
        private void ShowMoonlightSensorSponsorName(Entity sensor)
        {
            var names = Main.SponsorManager.GetSponsorPlanNames(SponsorPlans.Sensor.TYPE, SponsorPlans.Sensor.MOONLIGHT_SENSOR);
            if (names.Length <= 0)
                return;
            sensor.Spawn(VanillaEffectID.floatingText, sensor.GetCenter(), rng.Next())?.Let(e =>
            {
                var name = names.Random(e.RNG);
                FloatingText.SetText(e, name);
            });
        }
        private void ShowGunpowderBarrelSensorSponsorName(Entity sensor)
        {
            var names = Main.SponsorManager.GetSponsorPlanNames(SponsorPlans.Furnace.TYPE, SponsorPlans.Furnace.GUNPOWDER_BARREL);
            if (names.Length <= 0)
                return;
            sensor.Spawn(VanillaEffectID.floatingText, sensor.GetCenter(), rng.Next())?.Let(e =>
            {
                var name = names.Random(e.RNG);
                FloatingText.SetText(e, name);
            });
        }
    }
}
