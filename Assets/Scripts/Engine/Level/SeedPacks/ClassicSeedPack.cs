#nullable enable // autogenerated

using PVZEngine.Buffs;
using PVZEngine.Definitions;
using PVZEngine.Level;
using UnityEngine;

namespace PVZEngine.SeedPacks
{
    public class ClassicSeedPack : SeedPack
    {
        public ClassicSeedPack(LevelEngine level, SeedDefinition definition, long id) : base(level, definition, id)
        {
        }
        public int GetIndex()
        {
            return Level.GetSeedPackIndex(this);
        }
        public override bool Exists()
        {
            return GetIndex() >= 0;
        }
        public override BuffReference GetBuffReference(Buff buff)
        {
            return new BuffReferenceClassicSeedPack(ID, buff.ID);
        }
        protected override void OnUpdate(float rechargeSpeed)
        {
            base.OnUpdate(rechargeSpeed);
            if (!this.IsCharged())
            {
                var recharge = this.GetRecharge();
                recharge += rechargeSpeed * this.GetRechargeSpeed();
                recharge = Mathf.Min(this.GetMaxRecharge(), recharge);
                this.SetRecharge(recharge);
            }
        }
        #region 序列化
        public SerializableClassicSeedPack ToSerializable()
        {
            var seri = new SerializableClassicSeedPack();
            SaveToSerializable(seri);
            return seri;
        }
        public static ClassicSeedPack? CreateFromSerializable(SerializableClassicSeedPack seri, LevelEngine level)
        {
            var definition = level.Content.GetSeedDefinition(seri.seedID);
            if (definition == null)
                return null;
            var seedPack = new ClassicSeedPack(level, definition, seri.id);
            seedPack.InitFromSerializable(seri);
            return seedPack;
        }
        #endregion
        public override string ToString()
        {
            return $"ClassicSeedPack_{Definition}";
        }
    }
}
