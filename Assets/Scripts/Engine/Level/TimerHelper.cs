#nullable enable // autogenerated

using System.Collections.Generic;
using System.Diagnostics.CodeAnalysis;
using PVZEngine.Entities;
using Tools;
using UnityEngine;

namespace PVZEngine
{
    public static class TimerHelper
    {
        public static IEnumerable<float> IteratePassedFrames(this FrameTimer timer, float interval)
        {
            float lastFrame = timer.LastFrame + timer.LastFrameFraction / (float)timer.Precision;
            float currentFrame = timer.Frame + timer.FrameFraction / (float)timer.Precision;
            float start = Mathf.CeilToInt(lastFrame / interval);
            float end = Mathf.CeilToInt(currentFrame / interval);
            end = Mathf.Max(0, end);
            for (float t = start; t > end; t--)
            {
                yield return (t - 1) * interval;
            }
        }
        public static void ResetSeconds(this FrameTimer timer, float seconds)
        {
            timer.ResetTime(Ticks.FromSeconds(seconds));
        }
        public static bool PassedSeconds(this FrameTimer timer, float seconds)
        {
            return timer.PassedFrame(Ticks.FromSeconds(seconds));
        }
        public static bool PassedSecondsFromMax(this FrameTimer timer, float seconds)
        {
            return timer.PassedFrameFromMax(Ticks.FromSeconds(seconds));
        }
        public static bool PassedIntervalSeconds(this FrameTimer timer, float seconds)
        {
            return timer.PassedInterval(Ticks.FromSeconds(seconds));
        }
        public static bool RunToExpiredOrNull([NotNullWhen(false)] this FrameTimer? timer, float speed = 1)
        {
            if (timer == null)
                return true;
            return timer.RunToExpired(speed);
        }

        public static bool RunToExpiredAndNotNull([NotNullWhen(true)] this FrameTimer? timer, float speed = 1)
        {
            if (timer == null)
                return false;
            return timer.RunToExpired(speed);
        }

        public static FrameTimer NewSecondTimer(float seconds)
        {
            return new FrameTimer(Ticks.FromSeconds(seconds));
        }
        public static bool IsSecondsInterval(this Entity entity, float seconds, float offset = 0)
        {
            return entity.IsTimeInterval(Ticks.FromSeconds(seconds), Ticks.FromSeconds(offset));
        }
    }
}
