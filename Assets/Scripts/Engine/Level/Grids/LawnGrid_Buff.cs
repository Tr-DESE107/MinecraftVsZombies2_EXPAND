#nullable enable // autogenerated

using System;
using PVZEngine.Buffs;

namespace PVZEngine.Grids
{
    public partial class LawnGrid
    {
        #region 生命周期
        public void UpdateBuffs()
        {
            buffs.Update();
        }
        #endregion

        #region 事件回调
        private void OnBuffPropertyChangedCallback(IPropertyKey name)
        {
            properties.UpdateModifiedProperty(name);
        }
        private void OnModelInsertionAddedCallback(ModelInsertion insertion)
        {
            OnModelInsertionAdded?.Invoke(insertion);
        }
        private void OnModelInsertionRemovedCallback(ModelInsertion insertion)
        {
            OnModelInsertionRemoved?.Invoke(insertion);
        }
        #endregion

        #region 增益
        public BuffReference GetBuffReference(Buff buff)
        {
            return new BuffReferenceLawnGrid(GetIndex(), buff.ID);
        }
        private void InitBuffList()
        {
            buffs.OnPropertyChanged += OnBuffPropertyChangedCallback;
            buffs.OnModelInsertionAdded += OnModelInsertionAddedCallback;
            buffs.OnModelInsertionRemoved += OnModelInsertionRemovedCallback;
        }
        #endregion

        #region 序列化
        private void WriteBuffsToSerializable(SerializableGrid seri)
        {
            seri.buffs = buffs.ToSerializable();
        }
        private void InitBuffsFromSerializable(SerializableGrid seri)
        {
            buffs = BuffList.CreateFromSerializable(seri.buffs, Level, this);
            InitBuffList();
        }
        private void LoadBuffsFromSerializable(SerializableGrid seri)
        {
            if (seri.buffs != null)
                buffs.LoadFromSerializable(seri.buffs);
        }
        #endregion

        #region 事件
        public event Action<ModelInsertion>? OnModelInsertionAdded;
        public event Action<ModelInsertion>? OnModelInsertionRemoved;
        #endregion

        #region 属性
        IBuffList IBuffTarget.Buffs => buffs;
        private BuffList buffs = new BuffList();
        #endregion 属性
    }
}