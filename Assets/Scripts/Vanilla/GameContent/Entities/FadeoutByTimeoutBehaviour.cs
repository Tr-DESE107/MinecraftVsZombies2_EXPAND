#nullable enable // autogenerated

using MVZ2.Vanilla.Properties;
using PVZEngine;
using PVZEngine.Entities;
using PVZEngine.Level;
using PVZEngine.Modifiers;
using UnityEngine;

namespace MVZ2.Vanilla.Entities
{
    [EntityBehaviourDefinition(VanillaEntityBehaviourNames.fadeoutByTimeout)]
    public class FadeoutByTimeoutBehaviour : EntityBehaviourDefinition
    {
        public FadeoutByTimeoutBehaviour(string nsp, string name) : base(nsp, name)
        {
            AddModifier(ColorModifier.Multiply(EngineEntityProps.TINT, PROP_TINT_MULTIPLIER));
        }
        public override void Update(Entity entity)
        {
            base.Update(entity);
            var fadeTimeout = entity.GetProperty<float>(PROP_FADE_TIMEOUT);
            var fadeFrames = Ticks.FromSeconds(fadeTimeout);
            var alpha = entity.Timeout < 0 ? 1 : Mathf.Clamp01(entity.Timeout / fadeFrames);
            entity.SetProperty(PROP_TINT_MULTIPLIER, new Color(1, 1, 1, alpha));
        }
        public static readonly VanillaEntityPropertyMeta<float> PROP_FADE_TIMEOUT = new VanillaEntityPropertyMeta<float>("fade_timeout", 0.5f);
        public static readonly VanillaEntityPropertyMeta<Color> PROP_TINT_MULTIPLIER = new VanillaEntityPropertyMeta<Color>("tint_multiplier", Color.white);
    }
}
