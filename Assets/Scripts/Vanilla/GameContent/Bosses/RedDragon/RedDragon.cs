#nullable enable // autogenerated

using MVZ2.Vanilla.Bosses;
using MVZ2.Vanilla.Entities;
using MVZ2.Vanilla.Properties;
using PVZEngine.Callbacks;
using PVZEngine.Damages;
using PVZEngine.Entities;
using PVZEngine.Level;
using UnityEngine;

namespace MVZ2.GameContent.Bosses
{
    [EntityBehaviourDefinition(VanillaBossNames.redDragon)]
    public partial class RedDragon : BossBehaviour
    {
        public RedDragon(string nsp, string name) : base(nsp, name)
        {
        }

        #region 回调
        public override void Init(Entity boss)
        {
            base.Init(boss);
            stateMachine.Init(boss);
            stateMachine.StartState(boss, STATE_IDLE);
        }
        protected override void UpdateAI(Entity entity)
        {
            base.UpdateAI(entity);
            stateMachine.UpdateAI(entity);
        }
        protected override void UpdateLogic(Entity entity)
        {
            base.UpdateLogic(entity);
            stateMachine.UpdateLogic(entity);
        }
        public override void PreTakeDamage(DamageInput damageInfo, CallbackResult result)
        {
            base.PreTakeDamage(damageInfo, result);
            var entity = damageInfo.Entity;
            if (damageInfo.Amount > 600)
            {
                damageInfo.SetAmount(600);
            }
        }
        #endregion 事件

        public static Vector3 GetSpitSourcePosition(Entity entity)
        {
            return entity.Position + entity.GetFacingDirection() * 400 + Vector3.up * 40;
        }

        #region 字段
        public static int GetPhase(Entity entity) => entity.GetBehaviourField<int>(PROP_PHASE);
        public static void SetPhase(Entity entity, int value) => entity.SetBehaviourField(PROP_PHASE, value);
        public static Vector3 GetJumpTarget(Entity entity) => entity.GetBehaviourField<Vector3>(PROP_JUMP_TARGET);
        public static void SetJumpTarget(Entity entity, Vector3 value) => entity.SetBehaviourField(PROP_JUMP_TARGET, value);
        #endregion

        #region 常量
        private static readonly VanillaEntityPropertyMeta<int> PROP_PHASE = new VanillaEntityPropertyMeta<int>("phase");
        private static readonly VanillaEntityPropertyMeta<Vector3> PROP_JUMP_TARGET = new VanillaEntityPropertyMeta<Vector3>("jump_target");

        public const int STATE_IDLE = VanillaBossStates.IDLE;
        public const int STATE_APPEAR = VanillaBossStates.APPEAR;
        public const int STATE_STUNNED = VanillaBossStates.STUNNED;
        public const int STATE_DEATH = VanillaBossStates.DEATH;
        public const int STATE_SPIT = VanillaBossStates.RED_DRAGON_SPIT;
        public const int STATE_JUMP = VanillaBossStates.RED_DRAGON_JUMP;

        public const int ANIMATION_STATE_IDLE = 0;
        public const int ANIMATION_STATE_APPEAR = 1;
        public const int ANIMATION_STATE_STUNNED = 2;
        public const int ANIMATION_STATE_DEATH = 3;
        public const int ANIMATION_STATE_SPIT = 10000;
        public const int ANIMATION_STATE_JUMP = 10001;

        public const int PHASE_1 = 0;
        public const int PHASE_2 = 1;
        #endregion 常量
    }
}
