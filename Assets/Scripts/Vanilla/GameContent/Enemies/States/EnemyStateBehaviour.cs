#nullable enable // autogenerated

using MVZ2.Vanilla.Entities;
using PVZEngine.Entities;
using PVZEngine.Level;

namespace MVZ2.Vanilla.Enemies
{
    [EntityBehaviourDefinition(VanillaEntityBehaviourNames.enemyState)]
    public class EnemyStateBehaviour : AIEntityBehaviour, IEnemyStateBehaviour
    {
        public EnemyStateBehaviour(string nsp, string name) : base(nsp, name)
        {
        }

        protected override void UpdateAI(Entity entity)
        {
            base.UpdateAI(entity);
            entity.State = GetActionState(entity);
            entity.SetAnimationInt("State", entity.State);
            entity.SetAnimationInt("AnimationState", GetAnimationState(entity.State));
        }
        public virtual int GetAnimationState(int state)
        {
            return state;
        }
        private int GetActionState(Entity enemy)
        {
            if (enemy.IsDead)
            {
                return STATE_DEATH;
            }
            else if (enemy.IsPreviewEnemy())
            {
                return STATE_IDLE;
            }
            else
            {
                var over = enemy.GetStateOverride();
                if (over >= 0)
                {
                    return over;
                }
                return GetActiveState(enemy);
            }
        }
        protected virtual int GetActiveState(Entity enemy)
        {
            if (EnemyMeleeBehaviour.HasMeleeTarget(enemy))
            {
                return STATE_MELEE_ATTACK;
            }
            else if (enemy.IsCasting())
            {
                return STATE_CAST;
            }
            else
            {
                return STATE_WALK;
            }
        }
        public const int STATE_IDLE = VanillaEnemyStates.IDLE;
        public const int STATE_WALK = VanillaEnemyStates.WALK;
        public const int STATE_MELEE_ATTACK = VanillaEnemyStates.MELEE_ATTACK;
        public const int STATE_CAST = VanillaEnemyStates.CAST;
        public const int STATE_DEATH = VanillaEnemyStates.DEATH;
        public const int STATE_RANGED_ATTACK = VanillaEnemyStates.RANGED_ATTACK;
        public const int STATE_LEAVE = VanillaEnemyStates.LEAVE;
        public const int ANIMATION_STATE_IDLE = 0;
        public const int ANIMATION_STATE_WALK = 1;
        public const int ANIMATION_STATE_ATTACK = 2;
        public const int ANIMATION_STATE_CAST = 3;
        public const int ANIMATION_STATE_DEATH = 4;
        public const int ANIMATION_STATE_PRIVATE = 10000;
    }
}