#nullable enable // autogenerated

using System.Linq;
using MVZ2.GameContent.Contraptions;
using MVZ2.GameContent.Seeds;
using MVZ2.Vanilla.Level;
using PVZEngine;
using PVZEngine.Definitions;
using PVZEngine.Level;
using UnityEngine;
using MVZ2.Vanilla.Grids;

namespace MVZ2.GameContent.Stages
{
    [StageDefinition(VanillaStageNames.LigneMaginot)]
    public partial class LigneMaginot : StageDefinition
    {
        public LigneMaginot(string nsp, string name) : base(nsp, name)
        {

            AddBehaviour(new WaveStageBehaviour(this));
            AddBehaviour(new FinalWaveClearBehaviour(this));
            AddBehaviour(new GemStageBehaviour(this));
            AddBehaviour(new StarshardStageBehaviour(this));
        }
        public override void OnSetup(LevelEngine level)
        {
            base.OnSetup(level);

            var allContraptions = new NamespaceID[]
            {

        VanillaContraptionID.Bedrock,
        VanillaContraptionID.Bedrock,
        VanillaContraptionID.Bedrock,
        VanillaContraptionID.Bedrock,
        VanillaContraptionID.Bedrock,

            };

            int Num = 5;

            var rand = new System.Random();

            // ���ѡ Num �����ظ�װ��
            var selectedContraptions = allContraptions.OrderBy(x => rand.Next()).Take(Num).ToArray();

            var usedPositions = new System.Collections.Generic.HashSet<(int, int)>();

            for (int i = 0; i < Num; i++)
            {
                int col, row;
                do
                {
                    col = 7; // 0~8��
                    row = rand.Next(0, 5);  // 0~4��
                } while (!usedPositions.Add((col, row)));

                float x = level.GetEntityColumnX(col);
                float z = level.GetEntityLaneZ(row);
                float y = level.GetGroundY(x, z);
                Vector3 pos = new Vector3(x, y, z);

                level.Spawn(selectedContraptions[i], pos, null);
            }
        }

    }
    
}
