#nullable enable // autogenerated

using MVZ2.Vanilla.Carts;
using PVZEngine.Entities;
using UnityEngine;

namespace MVZ2.Vanilla.Entities
{
    public static class VanillaCartExt
    {
        public static bool CanCartCrush(this Entity cart, Entity target)
        {
            if (cart == null)
                return false;
            var bounds = cart.GetBounds();
            return target.Type != EntityTypes.BOSS && target.IsVulnerableEntity() &&
                cart.IsHostile(target) &&
                target.ExistsAndAlive() &&
                cart.GetLane() == target.GetLane() &&
                target.Position.x >= bounds.min.x &&
                target.Position.x <= bounds.max.x;
        }
        public static bool IsCartTriggered(this Entity entity)
        {
            return entity.State == STATE_TRIGGERED;
        }
        public static void TriggerCart(this Entity entity)
        {
            entity.State = STATE_TRIGGERED;
            entity.Velocity = Vector3.right * 10;
            entity.PlaySoundIfNotNull(entity.GetCartTriggerSound());
            entity.SetCanUpdateBeforeGameStart(false);
            foreach (var behaviour in entity.Definition.GetBehaviours<ICartBehaviour>())
            {
                behaviour.PostTrigger(entity);
            }
        }
        public static void ChargeUpCartTrigger(this Entity entity)
        {
            CartCommonBehaviour.ChargeUpTrigger(entity);
        }
        public const int STATE_TRIGGERED = VanillaCartStates.TRIGGERED;
    }
}
